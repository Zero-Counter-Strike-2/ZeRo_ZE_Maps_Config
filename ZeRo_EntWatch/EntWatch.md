# ZeRo_EntWatch 神器配置指南 (Mode值更新版)

## 目录
- [配置文件位置](#配置文件位置)
- [配置文件结构](#配置文件结构)
- [配置参数详解](#配置参数详解)
- [Mode值功能说明](#mode值功能说明)
- [实际使用示例](#实际使用示例)
- [实体类型支持](#实体类型支持)
- [调试和故障排除](#调试和故障排除)

## 配置文件位置

配置文件位于: `configs/plugins/ZeRo_ZEModule/ZeRo_EntWatch/`

文件命名格式: `地图名.json` (例如: `ze_minecraft_adventure.json`)

## 配置文件结构

```json
{
  "武器HammerID": {
    "Id": "武器HammerID",
    "Name": "神器显示名称",
    "Skills": [
      {
        "Id": "按钮HammerID",
        "Name": "技能名称",
        "Cooldown": 冷却时间(秒),
        "MaxUses": 最大使用次数,
        "Mode": 技能模式(0-4)
      }
    ]
  }
}
```

## 配置参数详解

### 武器配置 (Weapon)

| 参数 | 类型 | 必填 | 描述 | 示例 |
|------|------|------|------|------|
| `Id` | string | 是 | 武器实体的Hammer ID | `"12345"` |
| `Name` | string | 是 | 武器显示名称 | `"Aegis盾"` |
| `Skills` | array | 是 | 技能列表 | `[技能配置]` |

### 技能配置 (Skill)

| 参数 | 类型 | 必填 | 描述 | 示例 |
|------|------|------|------|------|
| `Id` | string | 是 | 按钮实体的Hammer ID | `"12346"` |
| `Name` | string | 是 | 技能显示名称 | `"护盾"` |
| `Cooldown` | int | 是 | 冷却时间(秒) | `60` |
| `MaxUses` | int | 是 | 最大使用次数(-1为无限) | `3` |
| `Mode` | int | 是 | 技能模式(0-4) | `2` |

## Mode值功能说明

### 各Mode值对应功能

| Mode值 | 功能描述 | 使用次数 | 冷却时间 | 移除后行为 |
|--------|----------|----------|----------|------------|
| `0` | **一次性使用** | 1次 | 无 | 使用后立即禁用 |
| `1` | **仅冷却时间** | 无限 | 有 | 按钮移除后仍可使用(通过其他方式) |
| `2` | **冷却+次数限制** | 有限 | 有 | 按钮移除后仍可使用(通过其他方式) |
| `3` | **移除后禁用** | 有限 | 有 | 按钮移除后技能完全禁用 |
| `4` | **无限制使用** | 无限 | 无 | 始终可用 |

### 详细功能说明

#### Mode 0 - 一次性使用
- **特点**: 只能使用一次，使用后立即禁用
- **适用场景**: 传送、复活、终极技能
- **典型应用**: 
  ```json
  {
    "Id": "传送按钮ID",
    "Name": "紧急传送",
    "Cooldown": 0,
    "MaxUses": 1,
    "Mode": 0
  }
  ```

#### Mode 1 - 仅冷却时间
- **特点**: 无限使用，但有冷却时间限制
- **适用场景**: 常用技能、群体技能
- **典型应用**: 
  ```json
  {
    "Id": "火球术按钮ID",
    "Name": "火球术",
    "Cooldown": 30,
    "MaxUses": -1,
    "Mode": 1
  }
  ```

#### Mode 2 - 冷却+次数限制 (推荐默认)
- **特点**: 有限次数使用，每次使用后有冷却时间
- **适用场景**: 标准神器技能
- **典型应用**: 
  ```json
  {
    "Id": "护盾按钮ID",
    "Name": "神圣护盾",
    "Cooldown": 60,
    "MaxUses": 3,
    "Mode": 2
  }
  ```

#### Mode 3 - 移除后禁用
- **特点**: 有次数和冷却限制，当按钮实体被移除后技能完全禁用
- **适用场景**: 需要实体存在的技能
- **典型应用**: 
  ```json
  {
    "Id": "控制台按钮ID",
    "Name": "系统重启",
    "Cooldown": 120,
    "MaxUses": 5,
    "Mode": 3
  }
  ```

#### Mode 4 - 无限制使用
- **特点**: 无冷却时间，无使用次数限制
- **适用场景**: 被动技能、状态技能
- **典型应用**: 
  ```json
  {
    "Id": "加速按钮ID",
    "Name": "永久加速",
    "Cooldown": 0,
    "MaxUses": -1,
    "Mode": 4
  }
  ```

## 实际使用示例

### ze_example_map.json

```json
{
  "12345": {
    "Id": "12345",
    "Name": "Aegis盾",
    "Skills": [
      {
        "Id": "12346",
        "Name": "护盾技能",
        "Cooldown": 45,
        "MaxUses": 3,
        "Mode": 2
      }
    ]
  },
  "12347": {
    "Id": "12347",
    "Name": "火焰枪",
    "Skills": [
      {
        "Id": "12348",
        "Name": "火焰射击",
        "Cooldown": 15,
        "MaxUses": -1,
        "Mode": 1
      }
    ]
  },
  "12349": {
    "Id": "12349",
    "Name": "治疗枪",
    "Skills": [
      {
        "Id": "12350",
        "Name": "群体治疗",
        "Cooldown": 60,
        "MaxUses": 5,
        "Mode": 2
      }
    ]
  },
  "12351": {
    "Id": "12351",
    "Name": "传送装置",
    "Skills": [
      {
        "Id": "12352",
        "Name": "紧急传送",
        "Cooldown": 0,
        "MaxUses": 1,
        "Mode": 0
      }
    ]
  },
  "12353": {
    "Id": "12353",
    "Name": "控制台",
    "Skills": [
      {
        "Id": "12354",
        "Name": "系统重启",
        "Cooldown": 120,
        "MaxUses": 3,
        "Mode": 3
      }
    ]
  },
  "12355": {
    "Id": "12355",
    "Name": "加速光环",
    "Skills": [
      {
        "Id": "12356",
        "Name": "永久加速",
        "Cooldown": 0,
        "MaxUses": -1,
        "Mode": 4
      }
    ]
  }
}
```

## 实体类型支持

### 支持的按钮实体类型

1. **func_button** - 标准按钮
2. **func_rot_button** - 旋转按钮  
3. **func_door** - 门(需要Spawnflags 256)
4. **func_door_rotating** - 旋转门(需要Spawnflags 256)
5. **func_physbox** - 物理盒子

### 武器实体
- 所有 `weapon_*` 实体都会被自动检测

## 调试和故障排除

### 常见问题

#### 1. 神器不被识别
```json
// ❌ 错误 - 缺少顶层对象
[
  {
    "Id": "12345"
  }
]

// ✅ 正确 - 使用HammerID作为键
{
  "12345": {
    "Id": "12345",
    "Name": "神器名称"
  }
}
```

#### 2. 技能无法使用
```json
// ❌ 错误 - Id类型不匹配
{
  "Id": 12345,  // 应该是字符串
  "Skills": [
    {
      "Id": 12346  // 应该是字符串
    }
  ]
}

// ✅ 正确
{
  "Id": "12345",
  "Skills": [
    {
      "Id": "12346"
    }
  ]
}
```

### 调试方法

#### 1. 查看聊天输出
- 捡起神器: `[神器检测] 玩家名 捡起了 神器名`
- 使用技能: `[神器检测] 玩家名 使用了神器 技能名`
- 按钮检测: `[按钮检测] 玩家名 按下了 #按钮ID_按钮名`

#### 2. 查看控制台日志
```bash
# 启用详细日志
sv_cheats 1
developer 1
```

#### 3. 手动重载配置
```bash
# 重启地图或服务器来重新加载配置
```

### 配置验证

```json
// 完整验证示例
{
  "361240": {
    "Id": "361240",
    "Name": "神圣护盾",
    "Skills": [
      {
        "Id": "361241",
        "Name": "启动护盾",
        "Cooldown": 60,
        "MaxUses": 3,
        "Mode": 2
      }
    ]
  }
}
```

### 获取Hammer ID方法

1. 在Hammer编辑器中查看实体的 `Entity Index`
2. 游戏中使用实体检测工具
3. 查看服务器日志中的按钮检测信息

---
*配置文件会自动创建和更新，首次运行时会生成基础配置模板。不同Mode值适用于不同的游戏场景，请根据实际需求合理配置。*
